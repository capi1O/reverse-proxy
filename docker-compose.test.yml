version: '2'

services:
  reverse-proxy:
    image: monkeydri/reverse-proxy:latest
    # override CMD to pass docker hub build environment variables 
    command: ["sh", "-c", "/home/user/dockers/reverse-proxy/setup.sh ${EMAIL} ${URL} ${SUBDOMAINS} true ${SSH_PUBLIC_KEY} ${SSH_PRIVATE_KEY}"]
  sut:
    build:
      context: ./tests/
      args:
        - EMAIL=${EMAIL}
        - URL=${URL}
        - SUBDOMAINS=${SUBDOMAINS}
    environment:
      - EMAIL
      - URL
      - SUBDOMAINS
    depends_on:
      - reverse-proxy